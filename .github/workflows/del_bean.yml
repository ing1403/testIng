name: "Robot: Manual Delete (Enhanced)"

on:
  workflow_dispatch:
    inputs:
      target_branch:
        description: '‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠ Branch ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö (‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î‡∏ô‡∏∞!)'
        required: true
        type: string

permissions:
  contents: write # ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å! ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ö‡∏≠‡∏ó‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏ö

jobs:
  delete-branch-job:
    runs-on: ubuntu-latest
    steps:
      - name: "1. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"
        run: |
          echo "ü§ñ ‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏Å‡∏¥‡πà‡∏á: ${{ github.event.inputs.target_branch }}"
          echo "üë§ ‡∏™‡∏±‡πà‡∏á‡πÇ‡∏î‡∏¢: ${{ github.actor }}"

      - name: "2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (Safety Check)"
        run: |
          TARGET="${{ github.event.inputs.target_branch }}"
          if [ "$TARGET" == "main" ] || [ "$TARGET" == "master" ] || [ "$TARGET" == "develop" ]; then
            echo "‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô: ‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏ö‡∏Å‡∏¥‡πà‡∏á‡∏´‡∏•‡∏±‡∏Å ($TARGET) ‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î!"
            exit 1
          else
            echo "‚úÖ ‡∏Å‡∏¥‡πà‡∏á $TARGET ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Å‡∏¥‡πà‡∏á‡∏´‡∏•‡∏±‡∏Å... ‡∏ú‡πà‡∏≤‡∏ô!"
          fi

      - name: "3. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏¥‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ö‡∏ô GitHub"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          TARGET="${{ github.event.inputs.target_branch }}"
          # ‡πÉ‡∏ä‡πâ gh api ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Å‡∏¥‡πà‡∏á‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÑ‡∏´‡∏°
          HTTP_CODE=$(gh api repos/${{ github.repository }}/branches/$TARGET --silent -o /dev/null -w "%{http_code}" || echo "404")
          
          if [ "$HTTP_CODE" != "200" ]; then
            echo "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏¥‡πà‡∏á‡∏ä‡∏∑‡πà‡∏≠ '$TARGET' ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö GitHub (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡∏™‡∏∞‡∏Å‡∏î‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á)"
            exit 1
          else
            echo "‚úÖ ‡∏û‡∏ö‡∏Å‡∏¥‡πà‡∏á '$TARGET' ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠..."
          fi

      - name: "4. ‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏•‡∏ö‡∏Å‡∏¥‡πà‡∏á (Action)"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          TARGET="${{ github.event.inputs.target_branch }}"
          echo "üî• ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏Å‡∏¥‡πà‡∏á $TARGET ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å GitHub..."
          gh api -X DELETE /repos/${{ github.repository }}/git/refs/heads/$TARGET
          echo "üöÄ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏¥‡πà‡∏á $TARGET ‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"